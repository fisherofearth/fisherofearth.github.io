<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>在github工作流中插入gitalk的clienSecret</title>
      <link href="/2022/05/02/%E4%BD%BF%E7%94%A8github-secrets%E5%9C%A8%E7%8E%AF%E5%A2%83%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%AD%E6%8F%92%E5%85%A5%E5%8A%A0%E5%AF%86%E5%80%BC/"/>
      <url>/2022/05/02/%E4%BD%BF%E7%94%A8github-secrets%E5%9C%A8%E7%8E%AF%E5%A2%83%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%AD%E6%8F%92%E5%85%A5%E5%8A%A0%E5%AF%86%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>美好的愿望：为Github page上的Hexo站点的 <a href="https://github.com/gitalk/gitalk/blob/master/readme-cn.md">gitalk</a> 设定非公开的ClientSecret。<br>Gitalk 可以为Hexo站点的post增加评论功能，评论自动推到github issue，挺方便的。<br><a href="https://github.com/gitalk/gitalk/blob/master/readme-cn.md">gitalk</a> 的配置需要ClientSecret，如直接明文写在_config.yml文件中，**不妥!**。但是也没办法，参考<a href="https://carl-zk.github.io/blog/2020/03/03/gitalk-%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/">Gitalk明文使用secret安全吗</a>。<br>Github提供了<a href="https://docs.github.com/cn/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-an-environment">Encrypted secrets</a>功能，原以为能解决这个问题，但仍只能在静态文件上明文写出client secret，但起码主分支上看不到明文的secret了。</p><h2 id="为gitalk注册一个OAth应用"><a href="#为gitalk注册一个OAth应用" class="headerlink" title="为gitalk注册一个OAth应用"></a>为<a href="https://github.com/gitalk/gitalk/blob/master/readme-cn.md">gitalk</a>注册一个OAth应用</h2><ol><li><p>登录你的Github账户</p></li><li><p><a href="https://github.com/settings/developers">注册OAuth apps</a> –&gt; <a href="https://github.com/settings/applications/new">New OAthApp</a></p><blockquote><p>Application name: 随意<br>Homepage URL: Github page 的域名，如果时custom domin，就用它<br>Application description: 随意<br>Authorization callback URL: 同Homepage URL<br>Enable Device Flow: 不选</p></blockquote></li></ol><p>在<a href="https://github.com/settings/developers">OAuth apps</a>点击进入你注册好的App, 如下创建secret。至此，你拿到了 <strong>ClientID</strong> 和 <strong>ClientSecret</strong></p><img src="/2022/05/02/%E4%BD%BF%E7%94%A8github-secrets%E5%9C%A8%E7%8E%AF%E5%A2%83%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%AD%E6%8F%92%E5%85%A5%E5%8A%A0%E5%AF%86%E5%80%BC/OauthApps.png" class="" title="创建OAuth secret"><h2 id="创建仓库的Secret"><a href="#创建仓库的Secret" class="headerlink" title="创建仓库的Secret"></a>创建仓库的Secret</h2><div class="tabs" id="create-repository-secret"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#create-repository-secret-1">从Environment</button></li><li class="tab"><button type="button" data-href="#create-repository-secret-2">直接创建Secret</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="create-repository-secret-1"><img src="/2022/05/02/%E4%BD%BF%E7%94%A8github-secrets%E5%9C%A8%E7%8E%AF%E5%A2%83%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%AD%E6%8F%92%E5%85%A5%E5%8A%A0%E5%AF%86%E5%80%BC/createSecret1.png" class="" title="创建环境"><img src="/2022/05/02/%E4%BD%BF%E7%94%A8github-secrets%E5%9C%A8%E7%8E%AF%E5%A2%83%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%AD%E6%8F%92%E5%85%A5%E5%8A%A0%E5%AF%86%E5%80%BC/createSecret2.png" class="" title="创建secret"><img src="/2022/05/02/%E4%BD%BF%E7%94%A8github-secrets%E5%9C%A8%E7%8E%AF%E5%A2%83%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%AD%E6%8F%92%E5%85%A5%E5%8A%A0%E5%AF%86%E5%80%BC/createSecret3.png" class="" title="粘贴上一步拿到的 **ClientSecret**"><img src="/2022/05/02/%E4%BD%BF%E7%94%A8github-secrets%E5%9C%A8%E7%8E%AF%E5%A2%83%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%AD%E6%8F%92%E5%85%A5%E5%8A%A0%E5%AF%86%E5%80%BC/createSecret4.png" class="" title="创建secret"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="create-repository-secret-2"><img src="/2022/05/02/%E4%BD%BF%E7%94%A8github-secrets%E5%9C%A8%E7%8E%AF%E5%A2%83%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%AD%E6%8F%92%E5%85%A5%E5%8A%A0%E5%AF%86%E5%80%BC/createSecret5.png" class="" title="直接创建secret"><img src="/2022/05/02/%E4%BD%BF%E7%94%A8github-secrets%E5%9C%A8%E7%8E%AF%E5%A2%83%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%AD%E6%8F%92%E5%85%A5%E5%8A%A0%E5%AF%86%E5%80%BC/createSecret3.png" class="" title="粘贴上一步拿到的 **ClientSecret**"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="配置Gitalk"><a href="#配置Gitalk" class="headerlink" title="配置Gitalk"></a>配置Gitalk</h2><p>进入你的hexo本地工程<br>编辑主题配置文件 _config.butterfly.yml (此处以<a href="https://github.com/jerryc127/hexo-theme-butterfly">hexo-theme-butterfly</a>主题为例）</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">gitalk:</span> </span><br><span class="line">  <span class="attr">client_id:</span> <span class="string">&quot;前面申请的ClientID&quot;</span> </span><br><span class="line">  <span class="attr">client_secret:</span> <span class="string">$&#123;&#123;</span> <span class="string">secret.CLIENT_SECRET</span> <span class="string">&#125;&#125;</span> <span class="comment"># 假设你注册的secret名称是CLIENT_SECRET</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">&quot;你的Github page域名&quot;</span></span><br><span class="line">  <span class="attr">owner:</span> <span class="string">&quot;你的Github 用户名&quot;</span></span><br><span class="line">  <span class="attr">admin:</span> <span class="string">&quot;你的Github 用户名&quot;</span></span><br><span class="line">  <span class="attr">option:</span></span><br></pre></td></tr></table></figure><div class="note info flat"><p>详细设置请阅读 [gitalk][gitalk]*</p></div><div class="note warning flat"><p><strong>注意：别忘了选上选上Gitalk</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="attr">use:</span> <span class="string">Gitalk</span></span><br></pre></td></tr></table></figure><p>参考<a href="https://butterfly.js.org/posts/ceeb73f/">教程</a></p></div><h2 id="为工作流添加环境变量"><a href="#为工作流添加环境变量" class="headerlink" title="为工作流添加环境变量"></a>为工作流添加环境变量</h2><p>在你的workflow配置文件<code>.github/workflows/deploy_pages.yml</code>中添加透传</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># .github/workflows/deploy_pages.yml.yml</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">pages:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">environment:</span> <span class="string">gitalk</span> <span class="comment"># 这是一个环境，如果你的secret 不在 github 项目的 Environment 下，则不需要配置它</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Parser</span> <span class="string">secret</span> <span class="comment"># 透传你的secret给_config.butterfly.yml</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">jwsi/secret-parser@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">filename:</span> <span class="string">_config.butterfly.yml</span></span><br><span class="line">          <span class="attr">secret-name:</span> <span class="string">CLIENT_SECRET</span></span><br><span class="line">          <span class="attr">secret-value:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.CLIENT_SECRET</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure><p>Github Action 会把 环境变量中的 <code>CLIENT_SECRET</code> 明文地传入 <code>_config.butterfly.yml</code></p><h2 id="祝贺"><a href="#祝贺" class="headerlink" title=" 祝贺"></a><i class="fa fa-champagne-glasses"></i> 祝贺</h2><p>把你的site push到github上，完成部署，等待Github Action完成，如果一切顺利，可以在post下方以Github账号留言了。<br>如果去看page 项目的部署分支，在静态页面文件下，你将会看到明文的secret，虽然不合理，但应该“问题不大”。</p><h2 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h2><ul><li><a href="https://github.com/gitalk/gitalk/blob/master/readme-cn.md">Gitalk项目</a></li><li><a href="https://docs.github.com/cn/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-an-environment">Github 官方文档： Encrypted secrets</a></li><li><a href="https://github.com/jerryc127/hexo-theme-butterfly">hexo-theme-butterfly</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> github </tag>
            
            <tag> pages </tag>
            
            <tag> gitalk </tag>
            
            <tag> secret </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设置git全局代理</title>
      <link href="/2022/04/30/%E8%AE%BE%E7%BD%AEgit%E5%85%A8%E5%B1%80%E4%BB%A3%E7%90%86/"/>
      <url>/2022/04/30/%E8%AE%BE%E7%BD%AEgit%E5%85%A8%E5%B1%80%E4%BB%A3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------ User zone ---------</span></span><br><span class="line">proxy_protocol=<span class="string">&quot;socks&quot;</span> <span class="comment"># http/socks</span></span><br><span class="line">proxy_server=<span class="string">&quot;your_proxy_server_address&quot;</span> </span><br><span class="line">proxy_port=<span class="string">&quot;10086&quot;</span></span><br><span class="line"><span class="comment"># --------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">help</span>=<span class="string">&quot;Fail: Bad argument. \n </span></span><br><span class="line"><span class="string">  Usage: <span class="variable">$&#123;0&#125;</span> &lt;command&gt; \n</span></span><br><span class="line"><span class="string">  Command: \n \t set / unset \n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$#</span> -lt 1</span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">echo</span> -e <span class="variable">$&#123;help&#125;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$1</span> = <span class="string">&quot;set&quot;</span></span><br><span class="line"><span class="keyword">then</span>    </span><br><span class="line">    proxy=<span class="variable">$&#123;proxy_protocol&#125;</span>://<span class="variable">$&#123;proxy_server&#125;</span>:<span class="variable">$&#123;proxy_port&#125;</span></span><br><span class="line">    git config --global http.proxy <span class="variable">$&#123;proxy&#125;</span></span><br><span class="line">    git config --global https.proxy <span class="variable">$&#123;proxy&#125;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;http.proxy = &quot;</span>$(git config --global --get http.proxy)  </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;https.proxy = &quot;</span>$(git config --global --get https.proxy)</span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">test</span> <span class="variable">$1</span> = <span class="string">&quot;unset&quot;</span>   </span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    git config --global --<span class="built_in">unset</span> http.proxy</span><br><span class="line">    git config --global --<span class="built_in">unset</span> https.proxy</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Unset git proxy.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="variable">$&#123;help&#125;</span> </span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/04/30/hello-world/"/>
      <url>/2022/04/30/hello-world/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
